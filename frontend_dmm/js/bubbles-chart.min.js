/*!
  * bubbles-chart : Bubble chart
  * @version v0.0.3
  * @author Maximiliano Báez González <mxbg.py@gmail.com>
  */
var BubbleChart =(function () {function ConfigBuilder(){var a=["#FF6384","#4BC0C0","#FFCE56","#c2b9d6","#36A2EB","#8161c7","#196998","#8bc4eb","#4b36eb","#ffe197","#ffa4b7","#98e6e6","#c2b9d6","#36eb7c"];return{defaultColor:"#ddd",type:"none",width:500,height:500,sort:!1,percentage:!1,color:d3.scale.ordinal().range(a),color:d3.scale.ordinal().range(a),colour:!1,title:!1,leyend:!1,offset:5,padding:30,tooltip:!1,level:0,levels:[],filters:[],legend:!1,toggle:{title:"",size:!1},wave:{dy:11,count:4},tree:{speed:150,minRadius:10},animation:{speed:3e3,method:"no-recursive"},cluster:!0,firction:.85,bubble:{minRadius:10,animation:2e3,padding:10,allText:"Todos"},cols:5,autoHideLegend:!0,p:.3,timeContainer:"footer",listBubble:{minRadius:2,maxRadius:25,padding:5,textWidth:200},format:{text:function(a,b){return d3plus.string.title(a)},number:function(a,b){return d3plus.number.format(a)}}}}function BubbleEvents(){this.event={}}function BaseBuilder(a){BubbleEvents.call(this,a),this.dataArray=[],this.timeArray=[],this.timeSelection=[],this.filters={},this.filtersData={},this.config=a,a&&(this.config.colour=0==this.config.colour?this.config.label:this.config.colour,this.config.title=0==this.config.title?function(b){return b[a.label]}:this.config.title)}function UiBuilder(a){BaseBuilder.call(this,a)}function BubbleAnimation(a){this.config=a,this.initialize()}function BubbleBuilder(a){UiBuilder.call(this,a),a&&this.initialize()}function TreeBuilder(a){UiBuilder.call(this,a),this.rscale=0,this.center={node:[],ring:[],idx:0},a&&this.initialize()}function OrbitBuilder(a){TreeBuilder.call(this,a),this.rscale=0,this.center={node:[],ring:[],idx:0}}function d3Clone(a){return a.node().cloneNode(!0)}function ListBuilder(a){if(UiBuilder.call(this,a),this.rscale=0,this.activeFilters={},a){var b=this.config.xAxis;"string"==typeof this.config.xAxis&&(this.config.xAxis={},this.config.xAxis.key=b),this.initialize()}}function MotionBubble(a){UiBuilder.call(this,a),this.rscale=0,this.damper=.15,this.layoutGravity=-.01,this.xpadding=80,this.ypadding=100,this.txtHeight=50,a&&this.initialize()}function _BubbleChart(a){this.config=new ConfigBuilder;for(var b in a)"format"==b&&(a.format=d3plus.object.merge(this.config.format,a.format)),"object"==typeof this.config[b]?this.config[b]=$.extend(this.config[b],a[b]):this.config[b]=a[b];"tree"==this.config.type?this.builder=new TreeBuilder(this.config):"orbit"==this.config.type?this.builder=new OrbitBuilder(this.config):"list"==this.config.type?this.builder=new ListBuilder(this.config):"motion"==this.config.type?this.builder=new MotionBubble(this.config):this.builder=new BubbleBuilder(this.config)}d3.layout.orbit=function(){function a(){return a}function b(){function a(a){var b=j(a);if(b){var c=d3.layout.pie().value(function(a){return j(a)?4:1}),d=c(b);h.push({source:a,x:a.x,y:a.y,r:a.ring/2});for(var e=0;e<b.length;e++)b[e].angle=(d[e].endAngle-d[e].startAngle)/2+d[e].startAngle,b[e].parent=a,b[e].depth=a.depth+1,b[e].x=j(a)[e].parent.x+b[e].parent.ring/2*Math.sin(b[e].angle),b[e].y=b[e].parent.y+b[e].parent.ring/2*Math.cos(b[e].angle),b[e].x0=b[e].parent.x,b[e].y0=b[e].parent.y,b[e].deltaX=function(a){return a},b[e].deltaY=function(a){return a},b[e].ring=j(a)[e].parent.ring/i(a),f.push(b[e]),b[e].depth<=1}}var b=d;j(b)?c=b:(c={key:"root",values:b},j(c).forEach(function(a){a.parent=c}));c.x=e[0]/2,c.y=e[1]/2,c.deltaX=function(a){return a},c.deltaY=function(a){return a},c.ring=.75*e[0],c.depth=0,f.push(c),a(c)}var c,d,e=[1,1],f=[],g=d3.dispatch("tick"),h=[],i=function(){return 2.95},j=function(a){return a.children};return a.mode=function(){},a.size=function(a){return arguments.length?(e=a,this):e},a.revolution=function(a){return arguments.length?(tickRadianFunction=a,this):tickRadianFunction},a.orbitSize=function(a){return arguments.length?(i=a,this):i},a.orbitalRings=function(){return arguments.length?this:h},a.nodes=function(a){return arguments.length?(d=a,b(),this):f},a.children=function(a){return arguments.length?(j=a,this):j},d3.rebind(a,g,"on"),a},BubbleEvents.prototype.trigger=function(a,b){"undefined"!=typeof this.event[a]&&this.event[a](b)},BaseBuilder.prototype=new BubbleEvents,BaseBuilder.prototype.constructor=BaseBuilder,BaseBuilder.prototype.initialize=function(){},BaseBuilder.prototype.afterData=function(a){this.dataArray=$.extend([],a,!0)},BaseBuilder.prototype.data=function(a){this.afterData(a),this.builder(a),this.config.time&&this.timeline(),this.config.toggle.size&&this.sizeToggle(),this.config.levels.length>0&&this.breadcrumbs(),this.wrapText()},BaseBuilder.prototype.buildNodes=function(a,b){var c=this;b="undefined"!=typeof b?b:!0;for(var d=this.groupingData(a,b),e=0;e<d.length;e++)d[e].value=d[e][c.config.size];var f={children:d};return f},BaseBuilder.prototype.roolupFilters=function(a,b){var c=this.config.filters.map(function(a){return a.value});if(-1!=c.indexOf(b)){this.filters[b]="undefined"==typeof this.filters[b]?[]:this.filters[b],this.filtersData[b]="undefined"==typeof this.filtersData[b]?{}:this.filtersData[b];var d=this;a.forEach(function(a){-1==d.filters[b].indexOf(a[b])&&(d.filters[b].push(a[b]),d.filtersData[b][a[b]]={size:0,r:0,cnt:0}),d.filtersData[b][a[b]].size+=a[d.config.size],d.filtersData[b][a[b]].cnt+=1})}},BaseBuilder.prototype.roolup=function(a,b){var c={},d=this;for(var e in b)if(this.roolupFilters(a,e),e==this.config.time)c[e]=a.map(function(a){return-1==d.timeArray.indexOf(a[e])&&d.timeArray.push(a[e]),a[e]});else if(e==this.config.label)c[e]=a[0][e];else if("number"==typeof b[e])c[e]=d3.sum(a,function(a){return a[e]});else if(e==this.config.size)c[e]=d3.sum(a,function(a){return"number"!=typeof a[e]?parseFloat(a[e]):a[e]});else if("children"==e){c[e]=c[e]?c[e]:[];for(var f=0;f<a.length;f++)for(var g=0;g<a[f][e].length;g++)c[e].push(a[f][e][g])}else c[e]=a.map(function(a){return a[e]});return c},BaseBuilder.prototype.groupingData=function(a,b){var c=this,d=null,e=a.filter(function(a){var d=!0;if(!b)return!0;if("undefined"==typeof a[c.config.time])return!0;if("number"==typeof a[c.config.time])d=c.timeSelection.indexOf(a[c.config.time])>=0;else for(var e=0;e<a[c.config.time].length;e++)d=d&&c.timeSelection.indexOf(a[c.config.time][e])>=0;return 0==c.timeSelection.length||d}),f=d3.nest().key(function(a){return d=a,a[c.config.label]}).rollup(function(a){return c.roolup(a,d)}).entries(e);return f.map(function(a){return a.values})},UiBuilder.prototype=new BaseBuilder,UiBuilder.prototype.constructor=UiBuilder,UiBuilder.prototype.initialize=function(){this.prepareContainer()},UiBuilder.prototype.resizeViz=function(a){var b=$("#"+this.vizId),c=b.find("svg");b.animate({height:a},50),c.animate({height:a},50)},UiBuilder.prototype.bindMouseEvents=function(a){var b=this;a.on("click",function(a){b.trigger("click",a)}).on("mouseenter",function(a){b.trigger("mouseenter",a)}).on("mouseover",function(a){b.trigger("mouseover",a),d3.select(this).attr("stroke-width","5px"),b.createTooltip(this,a)}).on("mouseout",function(a){b.trigger("mouseout",a),d3.select(this).attr("stroke-width","1px"),d3plus.tooltip.remove(b.config.scope+"_visualization_focus")})},UiBuilder.prototype.prepareContainer=function(){this.diameter=$(this.config.container).height(),this.width=$(this.config.container).width()-this.config.padding,this.diameter=this.diameter<this.config.height?this.config.height:this.diameter,this.width=this.width<this.config.width?this.config.width:this.width,this.config.scope=this.config.container.replace("#",""),this.vizId=this.config.scope+"-viz",this.legendId=this.config.scope+"-legend","undefined"!=typeof this.config.legendId&&(this.legendId=this.config.legendId),this.legendColorId=this.config.scope+"-legend-color","undefined"!=typeof this.config.legendColorId&&(this.legendColorId=this.config.legendColorId),this.footerId=this.config.scope+"-footer",this.headerId=this.config.scope+"-header";var a=[this.headerId,this.vizId,this.legendId,this.legendColorId,this.footerId],b=["bubble-header","bubble-viz","bubble-legend","bubble-colors","bubble-footer"],c={};$(this.config.container).addClass("bubble-chart");for(var d=0;d<a.length;d++)c[a[d]]=$("<div />"),c[a[d]].attr("id",a[d]),c[a[d]].addClass(b[d]),$(this.config.container).append(c[a[d]]);c[this.vizId].height(this.diameter),c[this.vizId].width(this.diameter)},UiBuilder.prototype.text=function(a,b){function c(a){var b=235,c=d3.rgb(a);return c.r>=b&&c.g>=b&&c.b>=b}var d="undefined"!=typeof b&&"undefined"!=typeof b.type?b.type:"text",e=this;return a.append(d).attr("class","wrap").style("fill",function(a){var b=e.config.color(a[e.config.colour]);return b=d3plus.color.text(b),c(b)?e.config.defaultColor:b}).text(function(a){return e.config.format.text(a[e.config.label])})},UiBuilder.prototype.circle=function(a,b){var c=this;return b="undefined"==typeof b?{}:b,b.offset="undefined"==typeof b.offset?0:b.offset,b["class"]="undefined"==typeof b["class"]?"shape":b["class"],a.append("circle").attr("r",function(a){return a.r<b.offset?0:a.r-b.offset}).attr("class",b["class"]).style("fill",function(a){return"undefined"!=typeof b.fill?b.fill:c.config.color(a[c.config.colour])})},UiBuilder.prototype.createTooltip=function(a,b){var c=this,d=[{value:b[c.config.size],name:c.config.size}];this.config.percentage&&d.push({value:100*this.config.percentage(b),name:"Percentage"}),d=this.config.tooltip?this.config.tooltip(b):d;for(var e=0;e<d.length;e++)d[e].name=c.config.format.text(d[e].name),isNaN(d[e].value)?d[e].value=c.config.format.text(d[e].value):d[e].value=c.config.format.number(d[e].value);var f=$(a).position(),g=($("#"+this.vizId).position(),d3.select(a)),h=g.node().getBBox(),i=(d3.transform(g.attr("transform")).translate,300),j=15+35*d.length,k=20,l=f.left+h.width/2-i/2,m=f.top-j-k;l=0>l?0:l,m=0>l?0:m;var n={id:c.config.scope+"_visualization_focus",x:l,y:m,allColors:!0,fixed:!0,size:"small",color:c.config.color(b[c.config.colour]),fontfamily:"Helvetica Neue",fontweight:200,fontsize:"15px",data:d,width:i,max_width:i,mouseevents:!1,arrow:!0,align:"bottom center",anchor:"top left",title:c.config.format.text(c.config.title(b))};d3plus.tooltip.create(n)},UiBuilder.prototype.wrapText=function(){$("#"+this.vizId).find(".wrap").each(function(){d3plus.textwrap().container(d3.select(this)).resize(!0).align("middle").valign("middle").draw()})},UiBuilder.prototype.breadcrumbs=function(){for(var a=$("<ul class='bubble-hierarchies'/>"),b=$("<li / >"),c=$("<a class='bubble-levels disable'/>"),d=0;d<this.config.levels.length;d++){var e=b.clone(),f="bubble-li-lvl-"+d,g=c.clone();g.attr("data-level",d),g.attr("id",f),g.attr("data-name",this.config.levels[d]),g.text(this.config.levels[d]),e.append(g),a.append(e)}var h=$("<ol class='bubble-breadcrumbs' />");$(this.config.container).prepend(h),$(this.config.container).prepend(a)},UiBuilder.prototype.drillup=function(){for(var a=this.config.level,b=$(this.config.container).find(".bubble-breadcrumbs"),c=$(this.config.container).find(".bubble-hierarchies"),d=c.find("[data-level]").length,e=a;d>e;e++){b.find("[data-level='"+e+"']").remove();var f=c.find("[data-level='"+e+"']"),g=f.attr("id");f.addClass("disable"),$("."+g).remove()}},UiBuilder.prototype.updateBreadcrumbs=function(a){var b=this.config.color(a[this.config.colour]),c=d3plus.color.text(b),d=$(this.config.container).find(".bubble-hierarchies"),e=d.find("[data-level='"+this.config.level+"']"),f=e.attr("id");e.removeClass("disable");var g="<style class='{id}'>";g+="a#{id}::before {border-color: {fill} {fill} {fill} transparent;}",g+="li:last-child a#{id}::after {border-color: {fill} {fill} {fill} {fill};}",g+="li a#{id}::after {border-left: 1em solid {fill};}",g+="a#{id}{background-color: {fill}; color:{text}}",g+="li:first-child a#{id}::before{border-color: {fill} {fill} {fill} {fill};}",g+="</style>",g=g.replace(/{id}/g,f).replace(/{fill}/g,b).replace(/{text}/g,c),e.append($(g));var h=$(this.config.container).find(".bubble-breadcrumbs"),i=$("<li/ >");i.attr("data-level",this.config.level);var j=$("<span class='text'/>"),k=$("<div class='note'/>");j.text(this.config.format.text(a[this.config.label])),k.text(this.config.format.number(a[this.config.size])),i.append(j),h.append(i)},UiBuilder.prototype.onChange=function(){var a=$.extend([],this.dataArray,!0);this.builder(a),this.wrapText()},UiBuilder.prototype.timeline=function(){var a="header"==this.config.timeContainer?this.headerId:this.footerId;a="#"+a,$(a).html("");var b=d3.select(a).append("ul").attr("class","timeline").attr("tabindex",1),c=this,d=this.timeArray.sort().map(function(a){var b={time:a};return(0==c.timeSelection.length||c.timeSelection.indexOf(a)>=0)&&(b._selected=!0),b}),e=b.selectAll("li").data(d).enter().append("li").attr("class","entry").classed("selected",function(a){return a._selected}).append("a").text(function(a){return a.time});d3.selectable(b,e,function(a){var d=[];b.selectAll("li").classed("selected",function(a){return a._selected&&d.push(a),a._selected}),c.timeSelection=d.map(function(a){return a.time}),c.onChange(),c.trigger("timechange",c.timeSelection)})},BubbleAnimation.prototype.animationTick=function(a,b,c){var d=this;c=c?c:this.config.animation.speed;var e=setInterval(function(){var c=$(".wave");b(c.length)?d[a]():clearInterval(e)},c)},BubbleAnimation.prototype.initialize=function(){return"recursive"==this.config.method?void this.animate():void this.animationTick("animate",function(a){return a>0},10)},BubbleAnimation.prototype.animateWave=function(a){var b=this;a.attr("transform",function(a){return"translate("+a.r+")"}),a.transition().duration(this.config.speed).ease("linear").attr("transform",function(a){return"translate( -"+a.r+")"}).attr("T",1).each("end",function(){a.attr("T",0),"recursive"==b.config.method&&b.animateWave(a)})},BubbleAnimation.prototype.animate=function(){var a=this;d3.selectAll("path").filter(function(a){var b=d3.select(this);return 0==b.attr("T")}).each(function(b,c){var d=d3.select(this);d.attr("T")>0||a.animateWave(d)})},BubbleBuilder.prototype=new UiBuilder,BubbleBuilder.prototype.constructor=BubbleBuilder,BubbleBuilder.prototype.builder=function(a){var b=this,c=d3.layout.pack().size([this.diameter,this.diameter]).padding(1.5);this.config.sort&&c.sort(function(a,b){return a.value-b.value});var d="#"+this.vizId;$(d).html("");var e=d3.select(d).append("svg").attr("width",this.width).attr("height",this.diameter).attr("class","bubble"),f=e.selectAll(".node").data(c.nodes(this.buildNodes(a)).filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});this.bindMouseEvents(f);var g=f.append("g");this.circle(g).style("stroke",function(a){var c=b.config.color(a[b.config.colour]);return d3plus.color.legible(c)});this.config.percentage?(this.circle(g,{offset:b.config.offset}).style("stroke","#FFF").style("stroke-width","2px"),this.buildGauge(f)):(this.circle(g),this.text(g)),"liquid"==this.config.type&&(this.animation=new BubbleAnimation(this.config.animation))},BubbleBuilder.prototype.fillPercentage=function(a){if(2*a.r<this.config.offset)return 0;var b=this.config.percentage(a);return b=2*a.r*(1-b),0>b?0:parseInt(b)},BubbleBuilder.prototype.buildWave=function(a){var b=this;a.append("path").attr("id",function(a){return"g-clip-rect"+d3plus.string.strip(a[b.config.label])}).attr("class","path wave").attr("T",0).attr("d",function(a){var c=b.fillPercentage(a);if(0==c)return"";for(var d=parseInt(2*-a.r),e=parseInt(4*a.r/b.config.wave.count),f="",g=c-a.r;d<2*a.r;)f+=" M "+d+" "+g+" q "+e/2+" "+b.config.wave.dy+" "+e+" 0",d+=e;return f+""})},BubbleBuilder.prototype.buildGauge=function(a){var b=a.append("g"),c=this,d=b.append("clipPath").attr("id",function(a){return"g-clip-"+d3plus.string.strip(a[c.config.label])});d.append("rect").attr("id",function(a){return"g-clip-rect"+d3plus.string.strip(a[c.config.label])}).attr("y",function(a){return-a.r+c.config.offset}).attr("x",function(a){return-a.r+c.config.offset}).attr("width",function(a){return 2*a.r<c.config.offset?0:2*a.r-c.config.offset}).attr("height",function(a){var b=c.fillPercentage(a);return b+=c.config.offset-c.config.wave.dy+1,0>b?0:b}),"liquid"!=this.config.type&&"wave"!=this.config.type||this.buildWave(d),this.circle(b,{offset:c.config.offset,fill:"#FFF"}).attr("clip-path",function(a){var b=window.location.href;return b=b.split("#")[0],b+="#g-clip-"+d3plus.string.strip(a[c.config.label]),"url("+b+")"}),this.text(b)},BubbleBuilder.prototype.sizeToggle=function(){var a=$("#"+this.footerId),b=$("<div></div>");b.addClass("bubble-toogle"),b.attr("id",this.footerId+"-toogle"),a.append(b);var c=this;d3plus.form().data(this.config.toggle.size).title(this.config.toggle.title).container("#"+this.footerId+"-toogle").id("value").text("text").type("toggle").draw();a.find(".d3plus_toggle").on("click",function(a){var b=$(this)[0],d=b.__data__;"undefined"!=typeof d&&(c.config.size=d.value,c.onChange())})},TreeBuilder.prototype=new UiBuilder,TreeBuilder.prototype.constructor=TreeBuilder,TreeBuilder.prototype.prepareData=function(a){var b=this,c=this.buildNodes(a.children);a.children=c.children,a[b.config.size]=d3.sum(a.children,function(a){return a[b.config.size]}),a.max=d3.max(a.children,function(a){return a[b.config.size]}),a.min=d3.min(a.children,function(a){return a[b.config.size]}),a.min=a.min==a.max?0:a.min;var d=5+a.children.length;return d=10>d?10:d,this.rscale=d3.scale.linear().domain([a.min,a.max]).range([0,this.diameter/d]),a},TreeBuilder.prototype.circle=function(a){function b(a,b){if(!(a.depth>1)){b=b?b:0;var d=c.rscale(a[c.config.size])-b;return a.max&&(d=c.diameter/6-b),a.r=d,d<c.config.tree.minRadius?c.config.tree.minRadius:d}}var c=this;a.append("circle").attr("class","shape").attr("r",b).style("fill",function(a){return c.config.color(a[c.config.colour])}).style("stroke",function(a){var b=c.config.color(a[c.config.colour]);return d3plus.color.legible(b)}),this.text(a);a.append("circle").attr("class","shape-border").filter(function(a){return!a.parent}).attr("r",function(a){return b(a,5)}).style("fill","transparent").style("stroke","white").style("stroke-dasharray","5,5").style("stroke-width","1px")},TreeBuilder.prototype.onChange=function(){var a=$.extend({},this.dataArray[this.config.level],!0);this.builder(a),this.wrapText()},TreeBuilder.prototype.redraw=function(a,b){var c=this.config.level;b?this.dataArray[c]=$.extend({},a,!0):a=$.extend({},this.dataArray[c],!0),this.builder(a),this.config.time&&this.timeline(),this.wrapText()},TreeBuilder.prototype.afterData=function(a){this.dataArray[this.config.level]=$.extend({},a,!0)},TreeBuilder.prototype.builder=function(a){var b="#"+this.vizId,c=this,d=document.getElementById(this.vizId);d.innerHTML="",orbitScale=d3.scale.linear().domain([1,3]).range([3.8,1.5]).clamp(!0);var e=d3.layout.orbit().size([this.diameter,this.diameter]).children(function(a){return a.children}).revolution(function(a){return a.depth}).orbitSize(function(a){return orbitScale(a.depth)}),f=this.prepareData(a);e.nodes(f);var g=$(b).find("svg");g=0==g.length?d3.select(b).append("svg"):d3.select(b).select("svg");var h=g.selectAll("g.node").data(e.nodes()).enter().append("g").attr("class",function(a){var b="node";return a.parent||(b+=" center"),b}).attr("transform",function(a){return a.parent?"translate("+a.x0+","+a.y0+")":"translate("+a.x+","+a.y+")"}).on("mouseover",function(a){c.trigger("mouseover",a),d3.select(this).attr("stroke-width","5px"),c.createTooltip(this,a)}).on("mouseout",function(a){c.trigger("mouseout",a),d3.select(this).attr("stroke-width","1px"),d3plus.tooltip.remove(c.config.scope+"_visualization_focus")}).on("click",function(a){c.onClick(d3.select(this),a)});h.transition().duration(this.config.tree.speed).ease("linear").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("T",1).each("end",function(){h.attr("T",0)}),this.circle(d3.selectAll("g.node")),d3.select("svg").selectAll("circle.orbits").data(e.orbitalRings()).enter().insert("circle","g").attr("class","ring").attr("r",function(a){return a.r}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("fill","none").style("stroke","black").style("stroke-dasharray","2,2").style("stroke-width","1px")},TreeBuilder.prototype.getCleandata=function(a,b){var c={};c[this.config.label]=a[this.config.label],c[this.config.size]=a[this.config.size],this.config.time&&a[this.config.time]&&(c[this.config.time]=a[this.config.time]),a.children&&(c.children=$.extend([],a.children,!0));var d=this.config.level;return d>=0&&(c._parent=$.extend({},this.dataArray[d],!0)),c},TreeBuilder.prototype.getChild=function(a){var b=$.extend({},this.dataArray[this.config.level],!0),c=this.buildNodes(b.children,!1);b.children=c.children;for(var d=0;d<b.children.length;d++)if(b.children[d][this.config.label]==a[this.config.label])return b.children[d];console.error("no child")},TreeBuilder.prototype.onClick=function(a,b){if(b.children&&(b.parent||b._parent)){var c=d3.select(".node.center"),d=c.select("circle.shape").attr("r"),e=c.attr("transform");this.animateRingNode(a,b,{cr:d,cxy:e})}},TreeBuilder.prototype.ringDrillup=function(a){this.config.level-=1;var b=this.getCleandata(a._parent);this.redraw(b),this.config.levels.length>0&&this.drillup(a)},TreeBuilder.prototype.ringDrilldown=function(a){var b=this.getCleandata(this.getChild(a));this.config.levels.length>0&&this.config.levels.length>this.config.level+1&&(this.updateBreadcrumbs(a),this.config.level+=1),this.redraw(b,!0)},TreeBuilder.prototype.transition=function(a,b,c){return a.transition().duration(this.config.tree.speed).ease("linear").attr("transform",b).attr("T",1).each("end",function(a){d3.select(this).attr("T",0),c&&c(this,a)})},TreeBuilder.prototype.animateRingNode=function(a,b,c){var d=this;this.transition(a,c.cxy),a.select(".shape").transition().duration(this.config.tree.speed).ease("linear").attr("r",c.cr).attr("T",1).each("end",function(b){a.select(".shape").attr("T",0),b.children&&(b.max?b._parent&&d.ringDrillup(b):d.ringDrilldown(b))})},OrbitBuilder.prototype=new TreeBuilder,OrbitBuilder.prototype.constructor=OrbitBuilder,OrbitBuilder.prototype.builder=function(a){var b="#"+this.vizId,c=this,d=document.getElementById(this.vizId);d.innerHTML="",orbitScale=d3.scale.linear().domain([1,3]).range([3.8,1.5]).clamp(!0);var e=d3.layout.orbit().size([this.diameter,this.diameter]).children(function(a){return a.children}).revolution(function(a){return a.depth}).orbitSize(function(a){return orbitScale(a.depth)}),f=this.prepareData(a);e.nodes(f);var g=$(b).find("svg");g=0==g.length?d3.select(b).append("svg"):d3.select(b).select("svg"),this.center.node.length>0&&(g.node().appendChild(this.center.node[this.center.idx-1]),g.node().appendChild(this.center.ring[this.center.idx-1]));var h=g.selectAll("g.node").data(e.nodes()).enter().append("g").attr("class",function(a){var b="node";return a.parent||(b+=" center"),b}).attr("transform",function(a){return a.parent?"translate("+a.x0+","+a.y0+")":"translate("+a.x+","+a.y+")"}).on("mouseover",function(a){c.trigger("mouseover",a),d3.select(this).attr("stroke-width","5px"),c.createTooltip(this,a)}).on("mouseout",function(a){c.trigger("mouseout",a),d3.select(this).attr("stroke-width","1px"),d3plus.tooltip.remove(c.config.scope+"_visualization_focus")}).on("click",function(a){c.onClick(d3.select(this),a)});h.transition().duration(this.config.tree.speed).ease("linear").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("T",1).each("end",function(){h.attr("T",0)}),this.circle(d3.selectAll("g.node")),d3.select("svg").selectAll("circle.orbits").data(e.orbitalRings()).enter().insert("circle","g").attr("class","ring").attr("r",function(a){return a.r}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("fill","none").style("stroke","black").style("stroke-dasharray","2,2").style("stroke-width","1px")},OrbitBuilder.prototype.onClick=function(a,b){if(b.children&&(b.parent||b._parent)){var c=d3.select(".node.center"),d=c.select("circle.shape").attr("r"),e=c.attr("transform");this.animateCenterNode(c,b),this.animateRingNode(a,b,{cr:d,cxy:e})}},OrbitBuilder.prototype.text=function(a,b){function c(a){var b=235,c=d3.rgb(a);return c.r>=b&&c.g>=b&&c.b>=b}var d="undefined"!=typeof b&&"undefined"!=typeof b.type?b.type:"text",e=this;return a.append(d).attr("class","wrap").style("fill",function(a){var b=e.config.color(a[e.config.colour]);return b=d3plus.color.text(b),c(b)?e.config.defaultColor:b}).text(function(a){return e.config.format.number(a[e.config.size])})},OrbitBuilder.prototype.orbitRotate=function(a,b,c){function d(a){var c=b.y-(g-h),d=b.x-(f-h),e=h,i=h,j=d-i,k=e-c,l=Math.atan2(k,j)*(180/Math.PI);return 0>l?l-180:l}var e=d3.select(".ring"),f=parseFloat(e.attr("cx")),g=parseFloat(e.attr("cy")),h=parseFloat(e.attr("r"));a.attr("transform",c.cxy);var i=a.select(".shape").attr("cx",function(a){return a.x-f}).attr("cy",function(a){return a.y-g}),j=this,k=this.config.tree.speed/2;i.transition().duration(k).ease("cubic").delay(function(a,b){return 120*b}).attrTween("transform",function(a,b){var c=d(a),b=d3.interpolate(0,c);return function(a){return"rotate("+b(a)+")"}}).each("end",function(){var b=a.attr("transform");b=b.split(";"),a.select(".shape").transition().duration(k).ease("linear").attr("cy",function(a){var b=a.r<j.config.tree.minRadius?j.config.tree.minRadius:a.r;return g-h-b-3*j.config.offset}).attr("T",1).each("end",function(){d3.select(this).attr("T",0),c.end(a,k)})})},OrbitBuilder.prototype.animateRingNode=function(a,b,c){function d(a,b){b=b?b:e.config.tree.speed,a.select(".shape").transition().duration(b).ease("linear").attr("r",c.cr).attr("T",1).each("end",function(b){a.select(".shape").attr("T",0),b.children&&(b.max?b._parent&&e.ringDrillup(b):e.ringDrilldown(b))})}var e=this;b.max?(c.cr=this.config.tree.minRadius,this.transition(a,function(a){return"translate ( "+2*a.x+","+a.y+")"},function(){d(a)})):(c.end=function(a,b){d(a,b)},this.orbitRotate(a,b,c))},OrbitBuilder.prototype.animateCenterNode=function(a,b){var c=this;if(b.max){var d=c.center.node.pop();if(c.center.ring.pop(),c.center.idx-=1,c.center.idx<=0)return void(c.center.idx=0);this.transition(d3.select(d),function(a){return"translate("+b.x+","+b.y+")"},function(){d.remove()})}else this.transition(a,function(a){return"translate("+-a.r/2+","+a.y+")"},function(b,d){a.attr("class","parent");var e="#"+c.vizId,f=d3.select(e).selectAll(".ring").attr("cx",0).attr("r",function(a){return 1.4*a.r}).attr("cy",function(a){return a.y});f.attr("class","parent-ring"),c.center.node.push(d3Clone(a)),c.center.ring.push(d3Clone(f)),c.center.idx+=1})},ListBuilder.prototype=new UiBuilder,ListBuilder.prototype.constructor=ListBuilder,ListBuilder.prototype.prepareContainer=function(){UiBuilder.prototype.prepareContainer.call(this),$("#"+this.vizId).width(this.width)},ListBuilder.prototype.data=function(a){this.afterData(a),this.pData=this.prepareData(a),this.config.filters.length>0&&this.buildFilter(),this.builder(this.pData),this.config.time&&this.timeline()},ListBuilder.prototype.buildFilter=function(){var a=this,b=[];this.config.filters.length>0&&(b=b.concat(this.config.filters));for(var c=this.headerId,d=0;d<b.length;d++){var e=b[d].value,f=$("#"+c),g=$("<div></div>"),h=c+"-"+e;g.addClass("bubble-toogle"),g.attr("id",h),f.append(g);var i=!0,j=this.filters[e].map(function(b){var c={text:b,value:b,attr:e};return i&&(c.selected=!1,i=!1,a.activeFilters[e]=b),c}),a=this;d3plus.form().data(j).container("#"+h).title(b[d].text).id("value").text("text").type("toggle").draw()}f.find(".d3plus_toggle").on("click",function(b){var c=$(this)[0],d=c.__data__;"undefined"!=typeof d&&(a.activeFilters[d.attr]=d.value,a.builder(a.pData))})},ListBuilder.prototype.roolup=function(a,b){for(var c in b)this.roolupFilters(a,c);return a},ListBuilder.prototype.prepareData=function(a){var b=this;this.groups=[];var c,d=d3.nest().key(function(a){return c=a,b.groups.indexOf(a[b.config.xAxis.key])<0&&b.groups.push(a[b.config.xAxis.key]),a[b.config.label]}).rollup(function(a){return b.roolup(a,c)}).entries(a);return d.max=d3.max(b.groups,function(a){return a}),d.min=d3.min(b.groups,function(a){return a}),d.map(function(a){return a[b.config.label]=a.key,a[b.config.size]=d3.sum(a.values,function(a){return a[b.config.size]}),a}),this.prepareScale(d),d},ListBuilder.prototype.prepareScale=function(a){var b=this.groups.length,c=!1;this.groups=this.groups.sort(function(a,b){return c||(c=isNaN(a)),a-b}),c&&(this.groups=this.groups.sort());var d=this.rowSize();this.w=d*b+this.config.listBubble.textWidth,d+=this.config.listBubble.textWidth;for(var e=[],f=1;b>=f;f++)e.push(d),d+=this.rowSize();this.x=d3.scale.ordinal().domain(this.groups).range(e),this.xAxis=d3.svg.axis().scale(this.x).orient("top"),"undefined"!=typeof this.config.xAxis.format&&this.xAxis.tickFormat(this.config.xAxis.format),this.xScale=d3.scale.ordinal().domain(this.groups).range(e)},ListBuilder.prototype.bindEvents=function(a){var b=this;a.on("click",function(a){b.trigger("click",a)}).on("mouseenter",function(a){b.trigger("mouseenter",a)}).on("mouseover",function(a){if(b.trigger("mouseover",a),b.createTooltip(this,a),"text"==this.nodeName){var c=d3.select(this).node().parentNode;d3.select(c).selectAll("circle").style("display","none"),d3.select(c).selectAll("text.value").style("display","block")}}).on("mouseout",function(a){if(b.trigger("mouseout",a),d3.select(this).attr("stroke-width","1px"),d3plus.tooltip.remove(b.config.scope+"_visualization_focus"),"text"==this.nodeName){var c=d3.select(this).node().parentNode;d3.select(c).selectAll("circle").style("display","block"),d3.select(c).selectAll("text.value").style("display","none")}})},ListBuilder.prototype.circle=function(a,b){var c=this,d=this.scale(b),e=a.selectAll("g").data(b.values).enter().append("circle").attr("cx",function(a,b){return c.xScale(a[c.config.xAxis.key])}).attr("cy",b.y).attr("r",function(a){return d(a[c.config.size])}).attr("fill",c.config.color(b[this.config.colour]));return this.bindEvents(e),e},ListBuilder.prototype.text=function(a,b){var c=this;return a.selectAll("g").data(b.values).enter().append("text").attr("y",b.y).attr("x",function(a){return c.xScale(a[c.config.xAxis.key])}).attr("class","value").text(function(a){return a[c.config.size]}).attr("fill",this.config.color(b[this.config.colour])).style("display","none")},ListBuilder.prototype.rowSize=function(){return(this.width-2*this.config.padding-this.config.listBubble.textWidth)/(this.groups.length+1)},ListBuilder.prototype.scale=function(a){var b=this,c=this.rowSize()-2*this.config.listBubble.padding;return c/=2,d3.scale.linear().domain([0,d3.max(a.values,function(a){return a[b.config.size]})]).range([this.config.listBubble.minRadius,c])},ListBuilder.prototype.filtrar=function(a){for(var b=this,c=[],d=0;d<a.length;d++){for(var e=[],f=0;f<a[d].values.length;f++){var g=a[d].values[f],h=!0;for(filter in b.activeFilters)h=h&&g[filter]==b.activeFilters[filter];h&&e.push(g)}if(e.length>0){var g=$.extend({},a[d],!0);g.values=e;for(filter in b.activeFilters)g[filter]=b.activeFilters[filter];c.push(g)}}return c},ListBuilder.prototype.builder=function(a){function b(a){return c+=1,a.y=c*d.rowSize(),a.y}var c=0,d=this,e=$.extend([],a,!0);e=this.filtrar(e),d3.select("#"+this.vizId).selectAll("svg").remove();var f=d3.select("#"+this.vizId).append("svg").style("width",this.width).attr("height",this.diameter),g=this.rowSize(),h=f.append("g").attr("transform","translate(0,"+g/2+")");h.append("g").attr("class","x axis").call(this.xAxis);var i=f.selectAll(".node").data(e).enter().append("g").attr("y",b).attr("class","node"),j=i.append("text").style("font-size","14px").attr("x",d.config.listBubble.padding).attr("width",this.config.listBubble.textWidth).attr("y",function(a){return a.y}).attr("class","label").text(function(a){return d.circle(d3.select(this.parentNode),a),d.text(d3.select(this.parentNode),a),a[d.config.label]}).each(function(){for(var a=d.config.listBubble.textWidth,b=d.config.listBubble.padding,c=d3.select(this),e=c.node().getComputedTextLength(),f=c.text();e>a+2*b&&f.length>0;)f=f.slice(0,-1),
c.text(f+"..."),e=c.node().getComputedTextLength()}).style("fill",function(a){return d.config.color(a[d.config.colour])});this.bindEvents(j);var k=this.rowSize()*e.length+3*d.config.padding;$("#"+this.vizId).height(k),f.attr("height",k)},MotionBubble.prototype=new UiBuilder,MotionBubble.prototype.constructor=MotionBubble,MotionBubble.prototype.prepareContainer=function(){UiBuilder.prototype.prepareContainer.call(this);var a=$("#"+this.vizId);a.width(this.width),this.center={x:this.width/2,y:this.diameter/2}},MotionBubble.prototype.buildFilter=function(){var a=[];this.config.filters.length>0&&(a.push({text:this.config.bubble.allText,value:"all"}),a=a.concat(this.config.filters));var b=this.headerId,c=$("#"+b),d=$("<div></div>");d.addClass("bubble-toogle"),d.attr("id",b+"-toogle"),c.append(d);var e=this;d3plus.form().data(a).container("#"+b+"-toogle").id("value").text("text").type("toggle").draw();c.find(".d3plus_toggle").on("click",function(a){var b=$(this)[0],c=b.__data__;"undefined"!=typeof c&&("all"!==c.value?(e.config.autoHideLegend&&($("#"+e.legendId).hide(),$("#"+e.legendColorId).hide()),e.groupAll(e.circles,c.value)):($("#"+e.legendId).show(),$("#"+e.legendColorId).show(),e.groupAll(e.circles)))})},MotionBubble.prototype.getMaxRadius=function(a){var b=null;for(var c in this.filtersData[a]){var d=this.filtersData[a][c];"string"!=typeof d&&(b=null==b||b<d.r?d.r:b)}return b},MotionBubble.prototype.calculateFilterCenter=function(){this.filterCenters={};var a=($("#"+this.vizId),this.config.cols);for(var b in this.filters){this.filterCenters[b]={};var c=this.filters[b].length;a=this.config.cols,a=a>c?c:a;var d=Math.ceil(c/a);d=1==d?2:d;for(var e=(this.width-2*this.xpadding)/a,f=(this.diameter-this.ypadding)/d,g=1,h=this.ypadding/2,i=0,j=0,k=0,l=0;c>l;l++){var m=this.filters[b][l],n=this.filtersData[b][m];n.r=Math.sqrt(n.r),g>a&&(g=1,h+=f+i+this.txtHeight+this.config.bubble.padding,i=0);var o=(parseInt(l/a),h+f+this.txtHeight+this.config.bubble.padding);k=o>k?o:k,i=i<n.r?n.r:i;var p=0;p=1===g?this.xpadding+e/2:j+e,j=p,this.filterCenters[b][m]={x:p,y:o,r:n.r,size:n.size,filter:m},g+=1}var q=k+2*i+f+2*this.txtHeight+2*this.config.bubble.padding+this.ypadding;this.filtersData[b].MAX_Y=q}this.resizeViz(this.diameter+this.ypadding)},MotionBubble.prototype.roolup=function(a,b){var c={},d=this;for(var e in b){this.roolupFilters(a,e);for(var f=0;f<a.length;f++)e==this.config.time?c[e]=a.map(function(a){return-1==d.timeArray.indexOf(a[e])&&d.timeArray.push(a[e]),a[e]}):e==this.config.size?c[e]=d3.sum(a,function(a){return a[e]}):c[e]=a[0][e]}return c},MotionBubble.prototype.buildNodes=function(a,b){var c=this;UiBuilder.prototype.buildNodes.call(this,a,b);var d=a,e=d3.max(d,function(a){return a[c.config.size]}),f=d3.min(d,function(a){return a[c.config.size]}),g=d3.sum(d,function(a){return a[c.config.size]});this.sizeData={},this.sizeData.max=e,this.sizeData.min=f,this.sizeData.sum=g,f=f==e?0:f;var h=d.length-10;h=5>h?5:h,h=h>30?30:h;var i=this.width/h,j="undefined"!=typeof this.config.bubble.maxRadius?this.config.bubble.maxRadius:i;if(i=j>i?i:j,this.config.bubble.maxRadius=i,this.config.bubble.minRadius=Math.floor(i/3),this.rscale=d3.scale.pow().exponent(.5).domain([f,e]).range([this.config.bubble.minRadius,this.config.bubble.maxRadius]),this.clusters=[],c.config.cluster){for(var k in this.filtersData[this.config.colour])"MAX_Y"!=k&&this.clusters.push(k);this.deltaY=Math.floor(this.diameter/this.clusters.length)}return d.forEach(function(a){c.config.cluster?(a.clusterX=c.center.x,a.clusterY=(c.clusters.indexOf(a[c.config.colour])+1)*c.deltaY):(a.x=Math.random()*c.width,a.y=Math.random()*c.diameter),a.value=a[c.config.size],a.r=c.rscale(a.value);for(var b in c.filters)c.filtersData[b][a[b]].r+=a.r*a.r}),d=d.sort(function(a,b){return b[c.config.size]-a[c.config.size]}),this.calculateFilterCenter(),d},MotionBubble.prototype.builder=function(a){d3.select("#"+this.vizId).html("");var b=d3.select("#"+this.vizId).append("svg").attr("width",this.width).attr("height",this.diameter);this.buildFilter();var c=this;this.nodes=this.buildNodes(a),this.circles=b.selectAll("circle").data(this.nodes).enter().append("circle").attr("class","node").attr("r",0).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("fill",function(a){return c.config.color(a[c.config.colour])}).attr("stroke-width",1).attr("stroke",function(a){var b=c.config.color(a[c.config.colour]),d=d3plus.color.legible(b);return b.toUpperCase()==d.toUpperCase()&&(d=d3plus.color.lighter(b,-.3)),d}),this.bindMouseEvents(this.circles),this.force=this.start(),this.groupAll(this.circles),this.config.legend&&(this.legend(),this.colorLegend())},MotionBubble.prototype.charge=function(a){return-Math.pow(a.r,2)/8},MotionBubble.prototype.start=function(){return this.circles.transition().ease("linear").duration(this.config.bubble.animation).attr("r",function(a){return a.r}),d3.layout.force().nodes(this.nodes).size([this.width,this.diameter])},MotionBubble.prototype.tickNodes=function(a,b){this.circles.each(b(a.alpha)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})},MotionBubble.prototype.clusterGroup=function(a){var b=this;a!=this.config.colour&&(this.force.on("tick",function(c){b.tickNodes(c,function(d){return"undefined"==typeof a?b.moveTowardsCenter(c.alpha,!0):b.moveTowardsFilter(c.alpha,a,!0)})}),this.force.start())},MotionBubble.prototype.groupAll=function(a,b){var c=this,d=!1,e=(new Date).getTime();c.currentFilterTime=e,c.hideFilters(),this.force.gravity(this.layoutGravity).charge(this.charge).friction(this.config.firction).on("tick",function(a){c.tickNodes(a,function(a){return"undefined"!=typeof b?(.08>a&&c.config.cluster&&c.config.colour!=b&&c.force.stop(),c.moveTowardsFilter(a,b,!1)):(.04>a&&c.config.cluster&&c.force.stop(),c.moveTowardsCenter(a,!1))})}).on("end",function(){c.config.cluster&&!d&&(c.force.stop(),c.clusterGroup(b),d=!0)}),"undefined"!=typeof b&&this.resizeViz(this.filtersData[b].MAX_Y),setTimeout(function(a){c.currentFilterTime===a&&c.displayFilters(b)},.8*this.config.bubble.animation,e),this.force.start()},MotionBubble.prototype.moveTowardsCenter=function(a,b){var c=this,d=0;return function(e){return d=c.config.cluster&&!b?e.clusterY:c.center.y,e.x=e.x+(c.center.x-e.x)*c.damper*a,e.y=e.y+(d-e.y)*c.damper*a}},MotionBubble.prototype.moveTowardsFilter=function(a,b,c){var d=this;return function(e){var f=d.filterCenters[b][e[b]];d3.select(this).attr("data-filter",e[b]);var g=f.y;if(b!==d.config.colour&&d.config.cluster&&!c){var h=Math.floor(f.r/d.clusters.length);g+=(d.clusters.indexOf(e[d.config.colour])+1)*h}return e.x=e.x+(f.x-e.x)*d.damper*a,e.x=e.x<=0?2*e.r:e.x,e.x=e.x+e.r>d.width+d.xpadding?e.x-e.r:e.x,e.y=e.y+(g-e.y)*d.damper*a,e.y}},MotionBubble.prototype.getLabelXY=function(a){var b={x:0,y:0},c="[data-filter= '"+a+"']";a==this.config.bubble.allText&&(c="circle.node");var d=this.config.bubble.padding;return $("#"+this.vizId).find(c).each(function(a){var c=parseFloat($(this).attr("cx")),e=parseFloat($(this).attr("cy")),f=parseFloat($(this).attr("r"));b.x=0==b.x||c-f<b.x?c-f:b.x,b.y=0==b.y||e+2*f>b.y?e+f+2*d:b.y}),b},MotionBubble.prototype.text=function(a,b,c){var d=this,e=a.append("g").attr("class","filters").filter(function(a){return"undefined"!=typeof b[a].r}).attr("transform",function(a){var e=b[a],f=d.getLabelXY(a);return f.x+=e.r,f.y+=d.config.bubble.padding,d.filtersData[c]?d.filtersData[c]&&d.filtersData[c].MAX_Y<=f.y&&(d.filtersData[c].MAX_Y=f.y+d.ypadding,d.resizeViz(d.filtersData[c].MAX_Y)):(f.y=.7*f.y,f.x=e.x),"translate("+f.x+","+f.y+")"}).attr("text-anchor","middle");e.append("text").attr("class","labels").text(function(a){return d.config.format.text(a)}).each(function(){for(var a=d.config.listBubble.textWidth,b=d.config.bubble.padding,c=d3.select(this),e=c.node().getComputedTextLength(),f=c.text();e>a+2*b&&f.length>0;)f=f.slice(0,-1),c.text(f+"..."),e=c.node().getComputedTextLength()}),e.append("text").attr("class","size").text(function(a){var c=b[a];return d.config.format.number(c.size)}).attr("y",20);return e},MotionBubble.prototype.displayFilters=function(a){var b,c,d=this;"undefined"==typeof a?(b=[this.config.bubble.allText],c={},c[this.config.bubble.allText]={filter:this.config.bubble.allText,r:this.diameter/2,size:this.sizeData.sum,x:this.center.x,y:this.center.y}):(b=d3.keys(this.filterCenters[a]),c=d.filterCenters[a]);var e=d3.select("#"+this.vizId).select("svg").selectAll(".filters").data(b).enter();return d.text(e,c,a)},MotionBubble.prototype.hideFilters=function(){d3.select("#"+this.vizId).selectAll(".filters").remove(),this.resizeViz(this.diameter+this.ypadding)},MotionBubble.prototype.colorLegend=function(){var a=$("#"+this.legendColorId),b=$("<ul></ul>"),c=$("<li><div class='bubble-color'></div><p class='color-label'></p></li>"),d=this.filtersData[this.config.colour];for(var e in d){var f=c.clone();"MAX_Y"!=e&&(f.find(".color-label").text(e),f.find(".bubble-color").css("background",this.config.color(e)),b.append(f))}var g=$("#"+this.vizId).height();a.css("margin-top",-g+"px"),a.append(b)},MotionBubble.prototype.legend=function(){function a(a,b){return a.append("circle").attr("r",b).attr("class","legend")}function b(a,b){var f="----- ";return f+=c.config.format.number(b),a.append("text").attr("x",e-d).text(f)}var c=this,d=this.config.bubble.minRadius,e=this.config.bubble.maxRadius,f=$("#"+this.vizId).height(),g=d3.select("#"+this.legendId).style("margin-top",-f+"px").attr("class","legend-container"),h=g.append("div").attr("class","legend-overview");this.config.legend.title&&h.append("h3").text(this.config.legend.title),h.append("p").text(this.config.legend.description);var i=g.append("svg");if(this.config.legend.footer){var j=g.append("div").attr("class","legend-footer");j.append("p").text(this.config.legend.footer)}var k=i.append("g").attr("transform","translate("+e+", "+e+")");b(k,this.sizeData.max).attr("y",-(e-16)),a(k,e).attr("cy",10),b(k,this.sizeData.min).attr("y",e-d),a(k,d).attr("cy",e)},_BubbleChart.prototype.data=function(a){this.builder.data(a)},_BubbleChart.prototype.on=function(a,b){this.builder.event[a]=b}; return _BubbleChart;})();